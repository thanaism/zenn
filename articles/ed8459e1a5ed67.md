---
title: 'Thirdwebã®claimConditionã‚’ç†è§£ã™ã‚‹'
emoji: 'ğŸŠ'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [thirdweb, ethereum, solidity]
published: false
publication_name: 'synschismo_inc'
---

# SDKçµŒç”±ã§Thirdwebã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’æ“ä½œã™ã‚‹

Thirdwebã®Dashboardã¯ä¾¿åˆ©ãªã®ã§ãã“ã§æ“ä½œã™ã‚Œã°ã„ã„ã‚“ã§ã™ãŒã€ã‚„ã‚Šã«ãã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚

- KMSã‚¦ã‚©ãƒ¬ãƒƒãƒˆãªã©ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆ
- å¤§é‡æ“ä½œãƒ»è‡ªå‹•åŒ–ãªã©ã‚’ã—ãŸã„å ´åˆ

ã¨ã„ã†ã“ã¨ã§SDKçµŒç”±ã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’æ“ä½œã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»Šå›ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚’æƒ³å®šã—ã¦ã€æœ€ä½é™ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ã€ãƒãƒã‚ŠãŒã¡ãªclaimConditionã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚

## accountã®ç”Ÿæˆ

client-sideã®å ´åˆã¯ã€walletã‚’ç¹‹ã’ã°ã‚ˆã„ã§ã™ãŒã€ã‚µãƒ¼ãƒãƒ¼ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§write transactionã‚’ç™ºè¡Œã™ã‚‹ã«ã¯ã€`account`ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

https://portal.thirdweb.com/typescript/v5/adapters

ä¸Šè¨˜ã®ãƒšãƒ¼ã‚¸ã«ã€ethersã‚„viemã¨é€£æºã—ãŸ`account`ã®ä½œæˆæ–¹æ³•ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€ã‚¹ãƒ‹ãƒšãƒƒãƒˆã§è¦ç‚¹ã®ã¿ç¤ºã—ã¾ã™ã€‚

```ts
import { createThirdwebClient } from 'thirdweb';
import { ethers6Adapter } from 'thirdweb/adapters/ethers6';

const client = createThirdwebClient({ secretKey: process.env.THIRDWEB_SECRET_KEY! });
const account = await ethers6Adapter.signer.fromEthers({ signer });
```

# setClaimCondition

ã•ã¦ã€accountã®æº–å‚™ãŒã§ãã‚‹ã¨å¾Œã¯ã ã„ãŸã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‹ã„ã¤ã¾ã‚“ã§èª­ã‚ã°Dashboardã‹ã‚‰ã®é¡æ¨ã§ãªã‚“ã¨ãªãä½¿ãˆã‚‹ã‚“ã§ã™ãŒã€claimConditionã¾ã‚ã‚Šã¯å‰æçŸ¥è­˜ãŒãªã„ã¨æˆ¸æƒ‘ã†äººã‚‚å°‘ãªããªã„ã®ã‹ã¨æ€ã„ã¾ã™ã€‚

ã¡ãªã¿ã«ã€å¤–è¦³ã¯å…¬å¼ã®Design Docsã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨è¦‹ã¤ã‘ã«ãã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

https://portal.thirdweb.com/contracts/design-docs/drop#claim-conditions

## Dashboardã§ã¯æŠ½è±¡åŒ–ã•ã‚Œã¦ã„ã‚‹ãŒã€SDKã§ã¯æ˜ç¤ºçš„ã«è¨­å®šãŒå¿…è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹

ãŸã¨ãˆã°ã€Thirdwebã®Dashboardä¸Šã§ã¯ã€`Only Owner`ã¨ã„ã†è¨­å®šãŒã§ãã¾ã™ã€‚

![image](/images/ed8459e1a5ed67/1.png)

ã—ã‹ã—ã€ã“ã‚Œã¨åŒç­‰ã®ã“ã¨ã‚’SDKã§ã‚„ã‚‹ã«ã¯ã€`Only Owner`ã®ã‚ˆã†ãªæŠ½è±¡ã¯ç”¨æ„ã•ã‚Œã¦ã„ãªã„ãŸã‚`overrideList`ã®æ˜ç¤ºçš„ãªè¨­å®šãŒå¿…è¦ã§ã™ã€‚

```ts
import { getContract, sendAndConfirmTransaction } from 'thirdweb';
import { setClaimConditions } from 'thirdweb/extensions/erc1155';
import { ethereum } from 'thirdweb/chains';

const contract = getContract({
  client,
  chain: ethereum,
  address: contractAddress,
});

const transaction = setClaimConditions({
  contract,
  tokenId,
  phases: [
    {
      maxClaimablePerWallet: 0n,
      overrideList: [{ address: account.address, maxClaimable: 'unlimited' }],
    },
  ],
});

await sendAndConfirmTransaction({ transaction, account });
```

# setClaimConditionsã¯å†…éƒ¨çš„ã«ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹

claim conditionã¯Merkle Treeã‚’ç”¨ã„ã¦ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

SDKã§`setClaimConditions`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæµã‚Œã§Merkle TreeãŒåˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

1. ã‚µãƒ¼ãƒãƒ¼ä¸Šã§Merkle Treeã‚’ç”Ÿæˆ
2. Merkle Treeã®ãƒ‡ãƒ¼ã‚¿ã‚’IPFSã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. ç”Ÿæˆã—ãŸMerkle Treeã®ãƒãƒƒã‚·ãƒ¥ã‚’ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«è¨˜éŒ²

## merkleRootãƒãƒƒã‚·ãƒ¥ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®ä¿å­˜

ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«`merkleRoot`ã«ãƒãƒƒã‚·ãƒ¥ãŒä¿ç®¡ã•ã‚Œã¾ã™ã€‚

```solidity:DropERC1155.sol
mapping(uint256 => ClaimConditionList) public claimCondition;
```

```solidity:IClaimConditionMultiPhase.sol
struct ClaimConditionList {
    uint256 currentStartId;
    uint256 count;
    mapping(uint256 => ClaimCondition) conditions;
    mapping(uint256 => mapping(address => uint256)) supplyClaimedByWallet;
}
```

```solidity:IClaimCondition.sol
struct ClaimCondition {
    uint256 startTimestamp;
    uint256 maxClaimableSupply;
    uint256 supplyClaimed;
    uint256 quantityLimitPerWallet;
    bytes32 merkleRoot;
    uint256 pricePerToken;
    address currency;
    string metadata;
}
```

ã“ã®ã‚ˆã†ã«ã€ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹claimConditionã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«ç›´æ¥è¨˜éŒ²ã•ã‚Œã¾ã™ãŒã€`overrideList`ã®é …ç›®ã¯Merkle Treeã‚’ç”¨ã„ã¦ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

## IPFS URIã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®ä¿å­˜

ã•ã‚‰ã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦`contractURI`ãŒã‚ã‚Šã€Merkle Treeãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ã„ã‚‹IPFS URIãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

```solidity:IContractMetadata.sol
function contractURI() external view returns (string memory);
```

```solidity:ContractMetadata.sol
string public override contractURI;
```

```ts
// ReturnType<typeof getContractMetadata>
{
  name: string;
  symbol: string;
  description: string;
  merkle: { [merkleRoot: `0x${string}`]: `ipfs://${string}` };
}
```

## IPFS URIã®ä¸­èº«

IPFS URIã®ä¸­èº«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```ts
{
  merkleRoot: `0x${string}`,
  baseUri: `ipfs://${string}`,
  originalEntriesUri: `ipfs://${string}`,
  shardNybbles: number,
  tokenDecimals: number,
  isShardedMerkleTree: boolean,
}
```

ã“ã“ã§ã€`isShardedMerkleTree`ãŒ`true`ã®å ´åˆã¯ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸMerkle Treeã®ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`shardNybbles`ã¯ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã€ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ãŸã‚ã®æ¡æ•°ã‚’ç¤ºã—ã¾ã™ã€‚

ãŸã¨ãˆã°ã€`shardNybbles`ãŒ`2`ã§ã‚ã‚Œã°ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…ˆé ­2æ¡ãŒã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚­ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

- claimerã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ`0x12...`ã®ã¨ã`${baseUri}/12`ãŒè©²å½“ãƒ‡ãƒ¼ã‚¿ã®URI
- claimerã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ`0x34...`ã®ã¨ã`${baseUri}/34`ãŒè©²å½“ãƒ‡ãƒ¼ã‚¿ã®URI

ã•ã‚‰ã«ã€`originalEntriesUri`ã¯overrideListã®å„ã‚¨ãƒ³ãƒˆãƒªãŒãã®ã¾ã¾æ ¼ç´ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®URIã§ã™ã€‚

# claimã•ã‚ŒãŸã¨ãã®claimConditionã®ãƒã‚§ãƒƒã‚¯

SDKã§`claimTo`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

1. getContractMetadataã‚’å®Ÿè¡Œã—ã€IPFS URIã‚’å–å¾—
2. IPFS URIã‹ã‚‰claimerã«å¯¾å¿œã—ãŸMerkle Treeã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
3. Merkle Treeã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰claimToã®å¼•æ•°`_allowListProof`ã‚’ç”Ÿæˆ

ã“ã®ã¨ãã€`_allowListProof`ã¯IPFSç”±æ¥ã®ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã€`setClaimConditions`ç›´å¾Œã«`claimTo`ã‚’å®Ÿè¡Œã™ã‚‹ã¨å‹•ä½œãŒä¸å®‰å®šãªå ´åˆãŒã‚ã‚Šã¾ã—ãŸã€‚

SDKã§IPFSãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã«ã€åæ˜ ãŒé…ã‚ŒãŸã‚Šã—ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

# ã¾ã¨ã‚

- SDKã®`setClaimConditions`ã§ã¯ã€`Only Owner`ã®ã‚ˆã†ãªè¨­å®šã®ä»•æ–¹ãŒã§ããªã„
- åŒã˜å†…å®¹ã¯ã€`overrideList`ã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã‚‹
- claimConditionã¯Merkle Treeã‚’ç”¨ã„ã¦ç®¡ç†ã•ã‚Œã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ã¯IPFSã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹
- IPFS URLã¯`contractURI`ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- `_allowListProof`ã¯IPFSç”±æ¥ã®ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã€`setClaimConditions`ç›´å¾Œã«`claimTo`ã‚’å®Ÿè¡Œã™ã‚‹ã¨å‹•ä½œãŒä¸å®‰å®šãªå ´åˆãŒã‚ã‚‹
